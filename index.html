<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>OTOS Signals</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root {
  --bg: #0f1115;
  --panel: #171a21;
  --accent: #00e676;
  --text: #e6e6e6;
  --muted: #9aa0a6;
  --danger: #ff5252;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  padding: 20px;
  background: var(--bg);
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

h1 {
  margin-top: 0;
  font-size: 22px;
}

.small {
  color: var(--muted);
  font-size: 12px;
}

.signal {
  background: var(--panel);
  border-left: 4px solid var(--accent);
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 6px;
}

.signal.low { border-color: #6c757d; }
.signal.medium { border-color: #ffc107; }
.signal.high { border-color: var(--danger); }

.signal-title {
  font-weight: 600;
  margin-bottom: 6px;
}

.signal-notes {
  font-size: 14px;
  color: var(--muted);
}

.signal-meta {
  margin-top: 6px;
  font-size: 11px;
  color: var(--muted);
}

.empty {
  text-align: center;
  margin-top: 60px;
  color: var(--muted);
}
</style>
</head>

<body>

<h1>Signals</h1>
<p class="small">Live feed · shared memory · Presence-aware</p>

<div id="signals"></div>

<div id="empty" class="empty" style="display:none;">
  No signals yet.<br />
  Signals added in Feeder appear here instantly.
</div>

<script>
const STORE_KEY = "signals";

/* -------- Storage -------- */
function loadSignals() {
  try {
    return JSON.parse(localStorage.getItem(STORE_KEY)) || [];
  } catch {
    return [];
  }
}

/* -------- Render -------- */
function render() {
  const container = document.getElementById("signals");
  const empty = document.getElementById("empty");
  const signals = loadSignals();

  container.innerHTML = "";

  if (!signals.length) {
    empty.style.display = "block";
    return;
  }

  empty.style.display = "none";

  signals.forEach(sig => {
    const el = document.createElement("div");
    el.className = `signal ${sig.confidence || "low"}`;

    el.innerHTML = `
      <div class="signal-title">${escapeHTML(sig.title)}</div>
      <div class="signal-notes">${escapeHTML(sig.notes || "")}</div>
      <div class="signal-meta">
        ${sig.confidence?.toUpperCase() || "LOW"} · 
        ${new Date(sig.ts).toLocaleString()}
      </div>
    `;

    container.appendChild(el);
  });
}

/* -------- Helpers -------- */
function escapeHTML(str) {
  return String(str).replace(/[&<>"']/g, m => ({
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': "&quot;",
    "'": "&#39;"
  }[m]));
}

/* -------- Live Sync -------- */
window.addEventListener("storage", e => {
  if (e.key === STORE_KEY) render();
});

/* -------- Init -------- */
render();
</script>

</body>
</html>
