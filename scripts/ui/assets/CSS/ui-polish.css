/* ui-polish.js — ADDITIVE ONLY (no baseline edits required) */

(function(){
  const prefersReduced = window.matchMedia?.('(prefers-reduced-motion: reduce)')?.matches;

  // ---------- Ticker: duplicate content to create seamless loop ----------
  function initTicker(){
    const ticker = document.querySelector('[data-otos-ticker]');
    if(!ticker) return;

    const track = ticker.querySelector('.otos-ticker__track');
    if(!track) return;

    // Clone items for seamless scrolling
    const clone = track.cloneNode(true);
    clone.setAttribute('aria-hidden', 'true');
    clone.classList.add('otos-ticker__track--clone');
    ticker.appendChild(clone);

    if(prefersReduced) return;

    // Measure total width to compute duration
    const trackWidth = track.scrollWidth;
    const speedPxPerSec = Number(ticker.getAttribute('data-otos-ticker-speed')) || 90; // tweak: 70–120
    const duration = Math.max(8, trackWidth / speedPxPerSec);

    // Apply animation via inline style (additive)
    const keyframesName = 'otosTickerScroll_' + Math.random().toString(36).slice(2);
    const style = document.createElement('style');
    style.textContent = `
      @keyframes ${keyframesName}{
        from{ transform: translate3d(0,0,0); }
        to{ transform: translate3d(-${trackWidth}px,0,0); }
      }
      [data-otos-ticker] .otos-ticker__track,
      [data-otos-ticker] .otos-ticker__track--clone{
        animation: ${keyframesName} ${duration}s linear infinite;
      }
      [data-otos-ticker]:hover .otos-ticker__track,
      [data-otos-ticker]:hover .otos-ticker__track--clone{
        animation-play-state: paused;
      }
    `;
    document.head.appendChild(style);

    // Offset the clone immediately after the first track
    clone.style.transform = `translate3d(${trackWidth}px,0,0)`;
  }

  // ---------- Micro: auto-add fade-in on key modules ----------
  function initFadeIns(){
    const els = document.querySelectorAll('[data-otos-fade]');
    els.forEach((el, i) => {
      el.classList.add('otos-fade-in');
      el.style.animationDelay = `${Math.min(i * 70, 420)}ms`;
    });
  }

  // ---------- Boot ----------
  document.addEventListener('DOMContentLoaded', function(){
    initTicker();
    initFadeIns();
  });
})();
