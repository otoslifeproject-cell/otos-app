<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OTOS 路 Parent Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Core styles -->
  <link rel="stylesheet" href="./styles.css" />

  <!-- Brand -->
  <link rel="icon" href="./brand/logo/otos-logo-400.png" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <img src="./brand/logo/otos-logo-400.png" alt="OTOS" />
      <span>Parent 路 Core Control</span>
    </div>
  </header>

  <main id="app">
    <!-- LEFT: Parent -->
    <section class="column parent">
      <h2>EYE21 路 Parent</h2>
      <div id="parentModules" class="module-stack"></div>
    </section>

    <!-- CENTER: Core -->
    <section class="column core">
      <h2>Core</h2>
      <div id="coreModules" class="module-stack"></div>
    </section>

    <!-- RIGHT: Agent -->
    <section class="column agent">
      <h2>Andy 路 Agent</h2>
      <div id="agentModules" class="module-stack"></div>
    </section>
  </main>

  <!-- Loader -->
  <script>
    async function loadRegistry() {
      const res = await fetch('./registry.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('Registry not found');
      return res.json();
    }

    function renderModule(row) {
      const div = document.createElement('div');
      div.className = 'module-card';
      div.innerHTML = `
        <div class="module-header">
          <span class="icon">${row.icon || ''}</span>
          <span class="title">${row.name}</span>
        </div>
        <div class="module-purpose">${row.purpose || ''}</div>
      `;
      return div;
    }

    function routeModule(row) {
      const group = (row.group || '').toLowerCase();
      if (group === 'core') return document.getElementById('coreModules');
      if (group === 'agent') return document.getElementById('agentModules');
      return document.getElementById('parentModules');
    }

    loadRegistry()
      .then(data => {
        data.forEach(row => {
          const target = routeModule(row);
          target.appendChild(renderModule(row));
        });
      })
      .catch(err => {
        document.body.innerHTML =
          '<pre style="padding:2rem">Registry load failed\n' + err.message + '</pre>';
      });
  </script>
</body>
</html>
