<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OTOS Cockpit â€” V1.1 (Locked)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

<!-- SKYHAWK -->
<header class="skyhawk" aria-label="SkyHawk ticker">
  <div class="ticker">
    <div class="ticker-track">
      <span>ğŸ›°ï¸ SKYHAWK Â· Signals Nominal</span>
      <span>Latency: 14ms</span>
      <span>Feeds: 6 active</span>
      <span>No anomalies detected</span>
      <span>ğŸ§  Focus: 1 task</span>
      <span>ğŸ”’ Inside: Active</span>

      <span>ğŸ›°ï¸ SKYHAWK Â· Signals Nominal</span>
      <span>Latency: 14ms</span>
      <span>Feeds: 6 active</span>
      <span>No anomalies detected</span>
      <span>ğŸ§  Focus: 1 task</span>
      <span>ğŸ”’ Inside: Active</span>
    </div>
  </div>
</header>

<!-- LOGO (LOCKED BASELINE POSITION + PATH) -->
<div class="logo-anchor" aria-hidden="true">
  <img
    src="brand/logo/otos-logo-400.png"
    class="otos-logo"
    alt=""
  />
</div>

<!-- WORKSPACE -->
<div class="workspace">

  <!-- LEFT: PARENT (Governance only) -->
  <section class="lane lane-parent">
    <div class="lane-head">
      <div class="lane-title">
        <span class="pill parent-pill">EYE22 Â· Parent Node</span>
        <span class="subpill">Governance only Â· Truth Â· Locks</span>
      </div>
      <div class="lane-actions">
        <button class="btn btn-ghost" id="btnSnapshot">Snapshot</button>
        <button class="btn" id="btnExport">Export</button>
        <button class="btn btn-ghost" id="btnSettings">Settings</button>
      </div>
    </div>

    <div class="card panel">
      <div class="panel-title">TOP PRIORITY (Focus Deck)</div>
      <div class="focus-card">
        <div class="focus-label">NOW</div>
        <div class="focus-title">Finish V1 UI wiring</div>
        <div class="focus-meta">
          Locked baseline Â· Parent + Andy lanes Â· Exportable intake
        </div>
      </div>
    </div>

    <div class="card panel chat-shell">
      <div class="panel-title">PARENT CHAT (V1)</div>

      <div class="chat-log" id="parentChatLog">
        <div class="msg sys">
          <div class="msg-role">SYSTEM</div>
          <div class="msg-text">
            Inside status: <strong>ACTIVE</strong>. Parent is governance-only.
          </div>
        </div>
      </div>

      <div class="chat-compose">
        <input
          id="parentInput"
          class="input"
          placeholder="Type governance noteâ€¦"
        />
        <button class="btn" id="parentSend">Add note</button>
      </div>
    </div>

    <div class="card panel telemetry" id="telemetryPanel">
      <div class="panel-title">TELEMETRY</div>
      <div class="telemetry-grid">
        <div><strong>Window</strong><br>Operational</div>
        <div><strong>Guardrails</strong><br>HARD-LOCKED</div>
        <div><strong>Andy</strong><br>Installed Â· Idle</div>
        <div><strong>Persistence</strong><br>ON</div>
      </div>
    </div>
  </section>

  <!-- MIDDLE: CORE (Tiles / Actions / Deck) -->
  <main class="lane lane-core" aria-label="Core tiles and action deck">
    <div class="lane-head">
      <div class="lane-title">
        <span class="pill core-pill">CORE Â· Tiles</span>
        <span class="subpill">Centre lane Â· modular grid</span>
      </div>
      <div class="lane-actions">
        <button class="btn btn-ghost small" id="btnCoreReset">Reset layout</button>
      </div>
    </div>

    <div class="card panel">
      <div class="panel-title">ACTIVE ACTION (Card)</div>
      <div class="action-card" id="activeAction">
        <div class="action-top">
          <div class="action-pill">READY</div>
          <div class="action-mini">No black box Â· deterministic ordering</div>
        </div>
        <div class="action-title">â€”</div>
        <div class="action-meta">Pin an action / promote from deck (next step wiring)</div>
        <div class="action-actions">
          <button class="btn btn-ghost small" id="btnSnooze">Snooze</button>
          <button class="btn small" id="btnComplete">Complete</button>
        </div>
      </div>
    </div>

    <div class="card panel">
      <div class="panel-title">EXPANDABLE DECK (Next 3â€“5)</div>
      <div class="deck" id="actionDeck"></div>
    </div>

    <div class="card panel">
      <div class="panel-title">MODULE TILES (Locked frame Â· movable tiles)</div>
      <div class="tiles" id="tileGrid">
        <div class="tile" data-tile="reminder">
          <div class="tile-head">
            <strong>Reminder Module</strong>
            <span class="tile-tag">locked</span>
          </div>
          <div class="tile-body">Capture â†’ due â†’ escalate (later wiring)</div>
        </div>

        <div class="tile" data-tile="radar">
          <div class="tile-head">
            <strong>Reality Radarâ„¢</strong>
            <span class="tile-tag">locked</span>
          </div>
          <div class="tile-body">Quiet Â· Guided Â· Anchored (later wiring)</div>
        </div>

        <div class="tile" data-tile="projects">
          <div class="tile-head">
            <strong>Projects</strong>
            <span class="tile-tag">data</span>
          </div>
          <div class="tile-body">Project â†’ Task â†’ Action schema (Notion-backed later)</div>
        </div>

        <div class="tile" data-tile="tasks">
          <div class="tile-head">
            <strong>Tasks</strong>
            <span class="tile-tag">context</span>
          </div>
          <div class="tile-body">Tasks contextualise Actions (never on Action Card)</div>
        </div>

        <div class="tile" data-tile="system">
          <div class="tile-head">
            <strong>System</strong>
            <span class="tile-tag">status</span>
          </div>
          <div class="tile-body">Export/Rehydrate Â· sessions Â· telemetry</div>
        </div>

        <div class="tile" data-tile="notes">
          <div class="tile-head">
            <strong>Notes</strong>
            <span class="tile-tag">local</span>
          </div>
          <div class="tile-body">Fast capture, later routed to intake</div>
        </div>
      </div>
    </div>
  </main>

  <!-- RIGHT: ANDY (Execution Agent) -->
  <aside class="lane lane-andy">
    <div class="lane-head">
      <div class="lane-title">
        <span class="pill andy-pill">Andy Â· Execution Agent</span>
        <span class="subpill">Ingest â†’ Archive (Tier 3)</span>
      </div>
      <div class="lane-actions">
        <button class="btn btn-ghost" id="btnClear">Clear</button>
      </div>
    </div>

    <div class="card panel dropzone" id="dropzone">
      <div class="dz-title">Drop files here</div>
      <div class="dz-sub">PDF Â· DOCX Â· TXT Â· PNG Â· ZIP</div>
      <div class="dz-mini">Local capture only</div>
    </div>

    <div class="card panel">
      <div class="panel-title">INTAKE QUEUE</div>
      <div id="queue" class="queue"></div>
    </div>

    <div class="card panel">
      <div class="panel-title">TASK CAPTURE</div>
      <div class="task-capture">
        <input id="taskInput" class="input" placeholder="Quick taskâ€¦" />
        <button class="btn" id="taskAdd">Add</button>
      </div>
      <div id="taskList" class="task-list"></div>
    </div>
  </aside>
</div>

<!-- SETTINGS PANEL -->
<div id="settingsPanel" class="settings-panel hidden" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="settings-card">
    <div class="settings-head">
      <strong>Settings (Local Only)</strong>
      <button class="btn btn-ghost" id="settingsClose">Close</button>
    </div>

    <label class="setting-row">
      Autosave
      <input type="checkbox" id="settingAutosave" />
    </label>

    <label class="setting-row">
      Show Telemetry
      <input type="checkbox" id="settingTelemetry" />
    </label>
  </div>
</div>

<footer class="footer">
  <span class="foot-pill">LOCKED BASELINE</span>
  <span class="foot-text">OTOS Cockpit V1.1 Â· Local-only</span>
</footer>

<script>
/* =============================
   STATE (LOCAL ONLY)
============================= */
const state = {
  notes: [],
  tasks: [],
  intake: [],
  actions: {
    active: null,
    deck: []
  },
  settings: {
    autosave: true,
    showTelemetry: true
  },
  ui: {
    tileOrder: ["reminder","radar","projects","tasks","system","notes"]
  }
};

const $ = id => document.getElementById(id);

/* =============================
   SETTINGS
============================= */
const savedSettings = localStorage.getItem("otos_settings");
if (savedSettings) {
  try { Object.assign(state.settings, JSON.parse(savedSettings)); } catch {}
}

const savedUI = localStorage.getItem("otos_ui");
if (savedUI) {
  try { Object.assign(state.ui, JSON.parse(savedUI)); } catch {}
}

function saveSettings(){
  localStorage.setItem("otos_settings", JSON.stringify(state.settings));
}
function saveUI(){
  localStorage.setItem("otos_ui", JSON.stringify(state.ui));
}

function applyTelemetryVisibility(){
  const el = $("telemetryPanel");
  if (!el) return;
  el.style.display = state.settings.showTelemetry ? "" : "none";
}

$("btnSettings").onclick = () => {
  $("settingsPanel").classList.remove("hidden");
  $("settingsPanel").setAttribute("aria-hidden","false");
  $("settingAutosave").checked = state.settings.autosave;
  $("settingTelemetry").checked = state.settings.showTelemetry;
};

$("settingsClose").onclick = () => {
  $("settingsPanel").classList.add("hidden");
  $("settingsPanel").setAttribute("aria-hidden","true");
};

$("settingAutosave").onchange = e => {
  state.settings.autosave = e.target.checked;
  saveSettings();
};

$("settingTelemetry").onchange = e => {
  state.settings.showTelemetry = e.target.checked;
  applyTelemetryVisibility();
  saveSettings();
};

applyTelemetryVisibility();

/* =============================
   PARENT NOTES
============================= */
$("parentSend").onclick = () => {
  const v = $("parentInput").value.trim();
  if (!v) return;
  state.notes.push({ t: Date.now(), text: v });
  $("parentInput").value = "";
  renderNotes();
  if (state.settings.autosave) persist();
};

function renderNotes(){
  const log = $("parentChatLog");
  log.innerHTML = `
    <div class="msg sys">
      <div class="msg-role">SYSTEM</div>
      <div class="msg-text">Parent governance log</div>
    </div>
  ` + state.notes.map(n =>
    `<div class="msg parent"><div class="msg-text">${escapeHTML(n.text)}</div></div>`
  ).join("");
}

/* =============================
   TASKS (local quick capture only)
============================= */
$("taskAdd").onclick = () => {
  const v = $("taskInput").value.trim();
  if (!v) return;
  state.tasks.push({ t: Date.now(), text: v });
  $("taskInput").value = "";
  renderTasks();
  if (state.settings.autosave) persist();
};

function renderTasks(){
  $("taskList").innerHTML = state.tasks.map(t =>
    `<div class="t-item">${escapeHTML(t.text)}</div>`
  ).join("");
}

/* =============================
   INTAKE (drag/drop local capture)
============================= */
const dz = $("dropzone");

dz.addEventListener("dragover", (e) => {
  e.preventDefault();
  dz.classList.add("dz-hover");
});
dz.addEventListener("dragleave", () => dz.classList.remove("dz-hover"));
dz.addEventListener("drop", (e) => {
  e.preventDefault();
  dz.classList.remove("dz-hover");
  const files = Array.from(e.dataTransfer.files || []);
  if (!files.length) return;

  files.forEach(f => {
    state.intake.push({
      id: crypto.randomUUID(),
      name: f.name,
      type: f.type || "unknown",
      size: f.size,
      lastModified: f.lastModified || null,
      capturedAt: Date.now(),
      status: "queued"
    });
  });

  renderQueue();
  if (state.settings.autosave) persist();
});

$("btnClear").onclick = () => {
  state.intake = [];
  renderQueue();
  if (state.settings.autosave) persist();
};

function renderQueue(){
  const q = $("queue");
  if (!state.intake.length) {
    q.innerHTML = `<div class="q-empty">No files queued</div>`;
    return;
  }
  q.innerHTML = state.intake.slice().reverse().map(item => {
    return `
      <div class="q-item">
        <div class="q-name">${escapeHTML(item.name)}</div>
        <div class="q-meta">
          <span>${escapeHTML(item.type)}</span>
          <span>${formatBytes(item.size)}</span>
          <span class="q-status">${escapeHTML(item.status)}</span>
        </div>
      </div>
    `;
  }).join("");
}

/* =============================
   CORE: Tiles ordering (simple deterministic â€œmoveableâ€)
============================= */
function renderTiles(){
  const grid = $("tileGrid");
  const map = {};
  Array.from(grid.children).forEach(el => {
    map[el.dataset.tile] = el;
  });
  grid.innerHTML = "";
  state.ui.tileOrder.forEach(k => {
    if (map[k]) grid.appendChild(map[k]);
  });
}

$("btnCoreReset").onclick = () => {
  state.ui.tileOrder = ["reminder","radar","projects","tasks","system","notes"];
  renderTiles();
  saveUI();
};

renderTiles();

/* =============================
   ACTION CARD / DECK (placeholders for wiring)
============================= */
function renderActions(){
  const active = $("activeAction");
  const titleEl = active.querySelector(".action-title");
  const metaEl = active.querySelector(".action-meta");

  if (!state.actions.active) {
    titleEl.textContent = "No active action selected";
    metaEl.textContent = "Promote from deck (next step wiring)";
  } else {
    titleEl.textContent = state.actions.active.title;
    metaEl.textContent = state.actions.active.meta || "";
  }

  const deck = $("actionDeck");
  if (!state.actions.deck.length) {
    deck.innerHTML = `<div class="deck-empty">Deck empty (wiring next)</div>`;
  } else {
    deck.innerHTML = state.actions.deck.map(a => `
      <div class="deck-item">
        <div class="deck-top">
          <strong>${escapeHTML(a.title)}</strong>
          <button class="btn btn-ghost small" data-promote="${escapeHTML(a.id)}">Promote</button>
        </div>
        <div class="deck-meta">${escapeHTML(a.meta || "")}</div>
      </div>
    `).join("");

    deck.querySelectorAll("[data-promote]").forEach(btn => {
      btn.onclick = () => {
        const id = btn.getAttribute("data-promote");
        const found = state.actions.deck.find(x => x.id === id);
        if (!found) return;
        state.actions.active = found;
        state.actions.deck = state.actions.deck.filter(x => x.id !== id);
        renderActions();
        if (state.settings.autosave) persist();
      };
    });
  }
}

$("btnSnooze").onclick = () => {
  // placeholder behaviour for now
  alert("Snooze wiring comes after Notion schema/queries are connected.");
};

$("btnComplete").onclick = () => {
  // placeholder behaviour for now
  alert("Complete wiring comes after Notion schema/queries are connected.");
};

renderActions();

/* =============================
   EXPORT / SNAPSHOT (json)
============================= */
$("btnExport").onclick = () => {
  downloadJSON("OTOS_V1_EXPORT.json", state);
};

$("btnSnapshot").onclick = () => {
  const stamp = new Date().toISOString().replace(/[:.]/g,"-");
  downloadJSON(`OTOS_SNAPSHOT_${stamp}.json`, state);
};

/* =============================
   PERSIST / REHYDRATE (localStorage)
============================= */
const savedState = localStorage.getItem("otos_state");
if (savedState) {
  try {
    const parsed = JSON.parse(savedState);
    // only hydrate safe keys
    if (parsed.notes) state.notes = parsed.notes;
    if (parsed.tasks) state.tasks = parsed.tasks;
    if (parsed.intake) state.intake = parsed.intake;
    if (parsed.actions) state.actions = parsed.actions;
  } catch {}
}

function persist(){
  localStorage.setItem("otos_state", JSON.stringify({
    notes: state.notes,
    tasks: state.tasks,
    intake: state.intake,
    actions: state.actions
  }));
}

renderNotes();
renderTasks();
renderQueue();
renderActions();

/* =============================
   UTILS
============================= */
function downloadJSON(filename, obj){
  const blob = new Blob([JSON.stringify(obj, null, 2)], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);
}

function formatBytes(bytes){
  if (!Number.isFinite(bytes)) return "â€”";
  const units = ["B","KB","MB","GB"];
  let i = 0;
  let v = bytes;
  while (v >= 1024 && i < units.length - 1) { v /= 1024; i++; }
  return `${v.toFixed(i === 0 ? 0 : 1)} ${units[i]}`;
}

function escapeHTML(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
</script>

</body>
</html>
