<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OTOS Cockpit v5 ‚Äì Living Project Field</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    /* Seamless soft gradient background */
    .otos-bg {
      background: radial-gradient(circle at top left, #f5fbff 0, #eaf4ff 35%, #f5f7ff 100%);
    }

    /* Apple-style glass panel */
    .glass-card {
      background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.82),
          rgba(248, 250, 252, 0.88)
        );
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-radius: 32px;
      border: 1.6px solid rgba(148, 163, 184, 0.45);
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.16),
        0 0 0 1px rgba(255, 255, 255, 0.4) inset;
    }

    .glass-tile {
      background: radial-gradient(circle at top left, #ffffff 0, #f1f5f9 55%, #e2e8f0 100%);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 24px;
      border: 1.3px solid rgba(148, 163, 184, 0.5);
      box-shadow:
        0 14px 30px rgba(15, 23, 42, 0.16),
        0 0 0 1px rgba(255, 255, 255, 0.5) inset;
      transition:
        transform 160ms ease-out,
        box-shadow 160ms ease-out,
        border-color 160ms ease-out,
        background 220ms ease-out;
    }

    .glass-tile:hover {
      transform: translateY(-4px) scale(1.01);
      box-shadow:
        0 20px 40px rgba(15, 23, 42, 0.22),
        0 0 0 1px rgba(255, 255, 255, 0.7) inset;
      border-color: rgba(59, 130, 246, 0.55);
    }

    .btn-shadow {
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.18);
    }

    .focus-active {
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.28);
    }

    .toast {
      position: fixed;
      right: 1.5rem;
      bottom: 1.5rem;
      z-index: 40;
    }

    footer {
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }
  </style>
</head>

<body class="otos-bg min-h-screen text-slate-800 flex flex-col">

  <!-- TOP BAR -->
  <header class="w-full border-b border-slate-200/80 bg-white/80 backdrop-blur-sm">
    <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3">
      <div class="flex items-center gap-3">
        <!-- OTOS Logo placeholder: swap for real SVG/PNG -->
        <div class="flex h-9 w-9 items-center justify-center rounded-2xl bg-slate-900 text-xs font-semibold tracking-[0.15em] text-white shadow-md">
          OT
        </div>

        <div class="flex flex-col">
          <span
            class="rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold tracking-wide text-slate-500 w-fit"
          >
            OTOS ‚Ä¢ LIVE FEED
          </span>
          <span class="text-[11px] text-slate-400">
            EYE17 ¬∑ ADHD cockpit ¬∑ Three-screen organism
          </span>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <label
          class="flex cursor-pointer items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1 text-xs text-slate-500 shadow-sm hover:bg-slate-50"
        >
          <span class="hidden sm:inline">Select otos_ui_model_v13.json‚Ä¶</span>
          <span class="sm:hidden">Select model‚Ä¶</span>
          <input type="file" class="hidden" />
        </label>
        <button
          id="btn-toggle-lock"
          class="rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-[11px] text-slate-600 hover:bg-slate-100"
        >
          üîí Layout locked
        </button>
      </div>
    </div>
  </header>

  <!-- MAIN LAYOUT (3-column cockpit) -->
  <main class="mx-auto flex w-full max-w-6xl flex-1 flex-col gap-4 px-4 pb-4 pt-5 lg:flex-row">

    <!-- LEFT COLUMN: PARENT NODE + TASK STACK -->
    <section class="flex w-full flex-col gap-4 lg:w-[30%]">
      <!-- PARENT NODE WINDOW -->
      <div class="glass-card p-4">
        <div class="mb-2 flex items-center justify-between">
          <h2 class="text-xs font-semibold tracking-[0.15em] text-slate-500">
            PARENT NODE ‚Ä¢ EYE17
          </h2>
          <span
            class="rounded-full bg-emerald-50 px-2.5 py-0.5 text-[11px] font-medium text-emerald-600 border border-emerald-200"
          >
            ONLINE
          </span>
        </div>

        <p class="text-[11px] leading-relaxed text-slate-600">
          System brain holding:<br />
          ‚Ä¢ HARD LOGS ¬∑ Kernel rules ¬∑ Network context<br />
          ‚Ä¢ Memory models ¬∑ Autonomy settings<br />
          Everything you see flows from here.
        </p>

        <div class="mt-3 flex flex-wrap gap-1.5 text-[11px]">
          <span class="rounded-full bg-blue-50 px-3 py-1 text-blue-600 border border-blue-200">
            Kernel Loaded
          </span>
          <span class="rounded-full bg-purple-50 px-3 py-1 text-purple-600 border border-purple-200">
            MemorySeeder ON
          </span>
          <span class="rounded-full bg-slate-100 px-3 py-1 text-slate-600 border border-slate-300">
            Sync Stable
          </span>
        </div>

        <!-- Agent summary strip -->
        <div class="mt-4 rounded-2xl bg-slate-900/90 p-3 text-[11px] text-slate-100 shadow-inner">
          <div class="mb-1 flex items-center justify-between">
            <span class="text-[10px] uppercase tracking-wide text-slate-400">
              Active Agents
            </span>
            <span class="rounded-full bg-emerald-500/20 px-2 py-0.5 text-[10px] text-emerald-200">
              All online
            </span>
          </div>
          <div class="flex flex-wrap gap-1.5">
            <span class="rounded-full bg-slate-800 px-2 py-1 text-[11px]">
              üß† Andy ¬∑ Ingest & Execute
            </span>
            <span class="rounded-full bg-slate-800 px-2 py-1 text-[11px]">
              ‚ö° OppGen ¬∑ Opportunity Engine
            </span>
            <span class="rounded-full bg-slate-800 px-2 py-1 text-[11px]">
              üõ∞Ô∏è SkyHawk ¬∑ Radar
            </span>
          </div>
        </div>

        <div class="mt-4 rounded-2xl bg-slate-50 p-3 text-[11px] ring-1 ring-slate-200/70">
          <div class="text-[10px] uppercase tracking-wide text-slate-400">
            Current Directive
          </div>
          <p class="mt-1 text-slate-600">
            Grow the middle screen into a living project field. Keep ADHD clarity
            and surface one top action at a time.
          </p>
        </div>
      </div>

      <!-- TASK STACK (LIVE CARDS) -->
      <div class="glass-card p-4 flex-1 min-h-[180px]">
        <div class="mb-2 flex items-center justify-between">
          <h2 class="text-xs font-semibold tracking-[0.15em] text-slate-500">
            TASK STACK
          </h2>
          <span
            class="rounded-full bg-slate-100 px-2.5 py-0.5 text-[11px] text-slate-400"
          >
            <span id="task-count">0</span> items
          </span>
        </div>

        <p class="mb-3 text-xs leading-relaxed text-slate-500">
          Each card is an approved tile. Click one to make it the focus task.
          The stack reorders live so the most important floats to the top.
        </p>

        <div id="task-stack" class="space-y-2 text-[11px]">
          <!-- Cards injected by JS -->
        </div>
      </div>
    </section>

    <!-- MIDDLE COLUMN: ONE THING ONLY + PROJECT FIELD -->
    <section class="flex w-full flex-col gap-3 lg:w-[40%]">
      <!-- ONE THING ONLY COMPACT BAR -->
      <div id="focus-card" class="glass-card p-4">
        <div class="mb-2 flex items-center justify-between">
          <div>
            <h2 class="text-xs font-semibold tracking-[0.15em] text-slate-500">
              ONE THING ONLY
            </h2>
            <p class="mt-1 text-xs text-slate-400">
              Click a project tile or stack card to set your focus.
            </p>
          </div>

          <span id="focus-badge" class="text-[11px] text-sky-500">Waiting for data‚Ä¶</span>
        </div>

        <label class="mt-2 block text-xs font-medium text-slate-500">
          Focus task title
          <input
            id="focus-title"
            type="text"
            placeholder="e.g. Build NHS demo view"
            class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 outline-none focus:border-blue-400 focus:bg-white focus:ring-1 focus:ring-blue-300"
          />
        </label>

        <p id="focus-description" class="mt-2 text-[11px] leading-relaxed text-slate-500">
          When you choose a task or project, its purpose will appear here so you
          remember why it matters.
        </p>

        <div class="mt-3 flex flex-wrap items-center gap-2">
          <button
            id="btn-start"
            class="btn-shadow rounded-full bg-blue-600 px-4 py-1.5 text-xs font-semibold text-white hover:bg-blue-500"
          >
            ‚ñ∂ Start Focus
          </button>

          <button
            id="btn-pause"
            class="rounded-full border border-slate-300 bg-slate-50 px-4 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-100"
          >
            ‚Äñ Pause
          </button>

          <button
            id="btn-done"
            class="rounded-full border border-emerald-500/70 bg-emerald-50 px-4 py-1.5 text-xs font-semibold text-emerald-700 hover:bg-emerald-100"
          >
            ‚úÖ Mark Done (local)
          </button>

          <div class="ml-auto flex items-center gap-1.5 text-[11px]">
            <span class="text-slate-400">Quick set:</span>

            <button
              data-minutes="15"
              class="btn-duration rounded-full bg-slate-100 px-2.5 py-1 text-[11px] text-slate-600 hover:bg-slate-200"
            >
              15m
            </button>

            <button
              data-minutes="25"
              class="btn-duration rounded-full bg-slate-100 px-2.5 py-1 text-[11px] text-slate-600 hover:bg-slate-200"
            >
              25m
            </button>

            <button
              data-minutes="50"
              class="btn-duration rounded-full bg-slate-100 px-2.5 py-1 text-[11px] text-slate-600 hover:bg-slate-200"
            >
              50m
            </button>
          </div>
        </div>

        <div class="mt-3 flex items-baseline gap-2">
          <span id="timer-label" class="text-xs text-slate-500">Focusing‚Ä¶</span>
          <span
            id="timer-display"
            class="text-lg font-semibold tabular-nums text-slate-800"
          >
            00:00
          </span>
        </div>
      </div>

      <!-- LIVING PROJECT FIELD -->
      <div class="glass-card flex-1 p-4">
        <div class="mb-2 flex items-center justify-between">
          <div>
            <h2 class="text-xs font-semibold tracking-[0.15em] text-slate-500">
              PROJECT FIELD
            </h2>
            <p class="mt-1 text-xs text-slate-400">
              Tiles self-adapt and grow like cells. Click any tile to focus it.
            </p>
          </div>
          <span class="rounded-full bg-slate-900/90 px-3 py-1 text-[11px] text-slate-100">
            Organism Mode
          </span>
        </div>

        <div
          id="project-grid"
          class="mt-2 grid auto-rows-[minmax(120px,1fr)] gap-3 sm:grid-cols-2 xl:grid-cols-3"
        >
          <!-- Tiles injected via JS -->
        </div>
      </div>
    </section>

    <!-- RIGHT COLUMN: FEEDER + MEMORY + SKYHAWK -->
    <section class="flex w-full flex-col gap-3 lg:w-[30%]">

      <!-- FEEDER -->
      <div class="glass-card p-4">
        <div class="mb-2 flex items-center justify-between">
          <h2 class="text-xs font-semibold tracking-[0.15em] text-slate-500">
            FEEDER
          </h2>
          <button class="text-[11px] text-sky-500 hover:text-sky-600">
            Sort &amp; classify
          </button>
        </div>

        <textarea
          id="feeder-input"
          rows="4"
          class="mt-1 w-full resize-none rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 outline-none focus:border-blue-400 focus:bg-white focus:ring-1 focus:ring-blue-300"
          placeholder="Drop text, notes, or ideas here. This simulates your Feeder DB and Memory Seeder."
        ></textarea>

        <div class="mt-2 flex flex-wrap gap-1.5 text-[11px]">
          <button data-tag="Rule / Protocol" class="chip-tag rounded-full bg-slate-100 px-3 py-1 text-slate-600 hover:bg-slate-200">
            Rule / Protocol
          </button>

          <button data-tag="Golden Statement" class="chip-tag rounded-full bg-slate-100 px-3 py-1 text-slate-600 hover:bg-slate-200">
            Golden Statement
          </button>

          <button data-tag="Idea / Plan" class="chip-tag rounded-full bg-slate-100 px-3 py-1 text-slate-600 hover:bg-slate-200">
            Idea / Plan
          </button>

          <button data-tag="Task / Decision" class="chip-tag rounded-full bg-slate-100 px-3 py-1 text-slate-600 hover:bg-slate-200">
            Task / Decision
          </button>

          <button data-tag="Code / Script" class="chip-tag rounded-full bg-slate-100 px-3 py-1 text-slate-600 hover:bg-slate-200">
            Code / Script
          </button>
        </div>

        <button
          id="btn-send-memory"
          class="btn-shadow mt-4 flex w-full items-center justify-center rounded-full bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-500"
        >
          ‚ûï Send to Memory (local only)
        </button>

        <p class="mt-2 text-[11px] leading-relaxed text-slate-500">
          This does not write to any external system yet ‚Äî it mirrors what the
          real Memory Seeder will do, so you can practise the flow without risk.
        </p>
      </div>

      <!-- MEMORY INSPECTOR -->
      <div class="glass-card p-4">
        <div class="mb-2 flex items-center justify-between">
          <h2 class="text-xs font-semibold tracking-[0.15em] text-slate-500">
            MEMORY INSPECTOR
          </h2>

          <span
            id="memory-count"
            class="rounded-full bg-slate-100 px-2.5 py-0.5 text-[11px] text-slate-400"
          >
            0 items
          </span>
        </div>

        <ul id="memory-list" class="space-y-1.5 text-[11px] text-slate-600">
          <li class="text-slate-400">
            Nothing stored yet. Use ‚ÄúSend to Memory‚Äù to add entries.
          </li>
        </ul>
      </div>

      <!-- SKYHAWK RADAR SUMMARY -->
      <div class="glass-card p-4">
        <div class="mb-2 flex items-center justify-between">
          <h2 class="text-xs font-semibold tracking-[0.15em] text-slate-500">
            SKYHAWK RADAR
          </h2>
          <span class="text-[11px] text-slate-400">Watching external signals‚Ä¶</span>
        </div>

        <ul id="skyhawk-list" class="space-y-1.5 text-[11px] text-slate-600">
          <li class="rounded-xl bg-slate-900/95 px-3 py-2 text-slate-100 shadow-inner">
            <span class="text-[10px] uppercase tracking-wide text-slate-400">
              Policy
            </span>
            <div class="mt-0.5">
              Streeting review on ADHD + digital access tagged as high relevance.
            </div>
          </li>
        </ul>
      </div>
    </section>
  </main>

  <!-- FOOTER: VERSION + RECORD BUTTON -->
  <footer class="mt-2 w-full border-t border-slate-200/70 bg-white/80">
    <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-2 text-[11px] text-slate-500">
      <div class="flex items-center gap-2">
        <span class="rounded-full bg-slate-100 px-2 py-0.5">OTOS Cockpit v5</span>
        <span>Build: <span id="build-timestamp"></span></span>
      </div>
      <div class="flex items-center gap-2">
        <button
          id="btn-record"
          class="rounded-full border border-rose-400 bg-rose-50 px-3 py-1 text-[11px] font-semibold text-rose-700 hover:bg-rose-100"
        >
          ‚è∫ Record now (idea / insight)
        </button>
        <span class="text-slate-400 hidden sm:inline">
          1-click capture flows into Andy ‚ûú Feeder ‚ûú Memory.
        </span>
      </div>
    </div>
  </footer>

  <!-- TOAST (SkyHawk messages) -->
  <div id="toast" class="toast hidden">
    <div class="rounded-xl bg-slate-900/90 px-4 py-2 text-xs text-slate-50 shadow-lg">
      <span id="toast-text">SkyHawk update‚Ä¶</span>
    </div>
  </div>

  <!-- LOCAL BRAIN: TIMER + MEMORY + TASK STACK + PROJECT FIELD + SKYHAWK -->
  <script>
    // ===== BUILD TIMESTAMP =====
    document.getElementById("build-timestamp").textContent =
      new Date().toLocaleString();

    // ===== LAYOUT LOCK (visual only for now) =====
    let layoutLocked = true;
    const btnToggleLock = document.getElementById("btn-toggle-lock");
    btnToggleLock.addEventListener("click", () => {
      layoutLocked = !layoutLocked;
      btnToggleLock.textContent = layoutLocked
        ? "üîí Layout locked"
        : "üîì Layout unlocked";
    });

    // ===== TIMER =====
    let timerSeconds = 0;
    let timerInterval = null;

    const timerDisplay = document.getElementById("timer-display");
    const timerLabel = document.getElementById("timer-label");
    const focusCard = document.getElementById("focus-card");
    const btnStart = document.getElementById("btn-start");
    const btnPause = document.getElementById("btn-pause");
    const btnDone = document.getElementById("btn-done");

    function renderTimer() {
      const m = String(Math.floor(timerSeconds / 60)).padStart(2, "0");
      const s = String(timerSeconds % 60).padStart(2, "0");
      timerDisplay.textContent = `${m}:${s}`;
    }

    function startTimer() {
      if (timerInterval) return;
      timerLabel.textContent = "Focusing‚Ä¶";
      focusCard.classList.add("focus-active");
      timerInterval = setInterval(() => {
        timerSeconds++;
        renderTimer();
      }, 1000);
    }

    function pauseTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
        timerLabel.textContent = "Paused";
        focusCard.classList.remove("focus-active");
      }
    }

    function resetTimer() {
      pauseTimer();
      timerSeconds = 0;
      renderTimer();
      timerLabel.textContent = "Ready";
      focusCard.classList.remove("focus-active");
    }

    btnStart.addEventListener("click", startTimer);
    btnPause.addEventListener("click", pauseTimer);
    btnDone.addEventListener("click", () => {
      resetTimer();
      timerLabel.textContent = "Done (local)";
    });

    document.querySelectorAll(".btn-duration").forEach((btn) => {
      btn.addEventListener("click", () => {
        const mins = Number(btn.dataset.minutes || "0");
        timerSeconds = mins * 60;
        renderTimer();
        timerLabel.textContent = `Set for ${mins} minutes`;
      });
    });

    renderTimer();

    // ===== MEMORY =====
    const feederInput = document.getElementById("feeder-input");
    const memoryList = document.getElementById("memory-list");
    const memoryCount = document.getElementById("memory-count");
    const btnSendMemory = document.getElementById("btn-send-memory");
    const memoryStore = [];

    document.querySelectorAll(".chip-tag").forEach((chip) => {
      chip.addEventListener("click", () => {
        const tag = chip.dataset.tag;
        const prefix = `[${tag}] `;
        const val = feederInput.value || "";
        if (!val.startsWith(prefix)) {
          feederInput.value = prefix + val;
        }
      });
    });

    function renderMemory() {
      memoryList.innerHTML = "";
      if (!memoryStore.length) {
        const li = document.createElement("li");
        li.className = "text-slate-400";
        li.textContent =
          "Nothing stored yet. Use ‚ÄúSend to Memory‚Äù to add entries.";
        memoryList.appendChild(li);
      } else {
        memoryStore.slice().reverse().forEach((item) => {
          const li = document.createElement("li");
          li.className =
            "rounded-lg bg-slate-50 px-2 py-1.5 leading-snug text-slate-700";
          li.textContent = item;
          memoryList.appendChild(li);
        });
      }

      memoryCount.textContent =
        memoryStore.length + " item" + (memoryStore.length === 1 ? "" : "s");
    }

    btnSendMemory.addEventListener("click", () => {
      const text = feederInput.value.trim();
      if (!text) return;
      memoryStore.push(text);
      feederInput.value = "";
      renderMemory();
    });

    renderMemory();

    // ===== RECORD NOW (stubbed hook) =====
    const btnRecord = document.getElementById("btn-record");
    btnRecord.addEventListener("click", () => {
      alert(
        "Record hook fired. In live build, this would start getUserMedia() audio capture and pipe straight into Andy + Feeder."
      );
    });

    // ===== TASKS / PROJECTS SHARED DATA =====
    const focusTitleInput = document.getElementById("focus-title");
    const focusDescriptionEl = document.getElementById("focus-description");
    const focusBadgeEl = document.getElementById("focus-badge");
    const taskStackEl = document.getElementById("task-stack");
    const taskCountEl = document.getElementById("task-count");
    const projectGridEl = document.getElementById("project-grid");

    const tasks = [
      {
        id: "nhs-pilot",
        title: "NHS Pilot ‚Ä¢ Cambridge",
        description: "Prepare live cockpit demo for CPFT / Sun Network pathway.",
        priority: 1,
        lane: "DO",
        source: "Andy + OppGen",
        progress: 0.6
      },
      {
        id: "ripple-deck",
        title: "Ripple Economy Evidence Deck",
        description: "Finalise slides connecting ADOS/DTD to Treasury numbers.",
        priority: 2,
        lane: "DO",
        source: "OppGen",
        progress: 0.4
      },
      {
        id: "chairman-outreach",
        title: "Key Charity Chairman ‚Ä¢ Profile + Email",
        description:
          "SkyHawk has located a potential flagship chair ‚Äì complete profile, capture contact, align with pilot.",
        priority: 3,
        lane: "DO",
        source: "SkyHawk",
        progress: 0.25
      },
      {
        id: "coming-soon",
        title: "Coming-Soon ADHD + Addiction Funnel",
        description:
          "Launch GR page and micro-test to start building list while core product finishes.",
        priority: 4,
        lane: "SHOULD",
        source: "Andy",
        progress: 0.2
      },
      {
        id: "spinspinsuga",
        title: "SpinSpinSuga ‚Ä¢ Sugar Addiction Network",
        description:
          "Create first educational sequence linking sugar addiction to OTOS.",
        priority: 5,
        lane: "SHOULD",
        source: "OppGen",
        progress: 0.1
      },
      {
        id: "mickey",
        title: "MickeySwings Golf Network",
        description:
          "Wire first affiliate offers and ADHD-friendly golf routines.",
        priority: 6,
        lane: "COULD",
        source: "Andy",
        progress: 0.05
      }
    ];

    function laneStyles(lane) {
      switch (lane) {
        case "DO":
          return {
            bg: "bg-emerald-50",
            text: "text-emerald-700",
            border: "border-emerald-200"
          };
        case "SHOULD":
          return {
            bg: "bg-amber-50",
            text: "text-amber-700",
            border: "border-amber-200"
          };
        case "COULD":
        default:
          return {
            bg: "bg-slate-100",
            text: "text-slate-700",
            border: "border-slate-200"
          };
      }
    }

    // ---- TASK STACK ----
    function renderTaskStack(highlightId = null) {
      const sorted = tasks.slice().sort((a, b) => a.priority - b.priority);
      taskStackEl.innerHTML = "";

      sorted.forEach((task) => {
        const lane = laneStyles(task.lane);
        const wrapper = document.createElement("article");
        wrapper.className =
          "group rounded-xl border bg-white px-3 py-2.5 shadow-sm transition-all cursor-pointer hover:-translate-y-0.5 hover:shadow-md flex flex-col gap-1";
        wrapper.classList.add(lane.border);

        if (task.id === highlightId) {
          wrapper.classList.add("ring-2", "ring-sky-300");
        }

        wrapper.setAttribute("data-task-id", task.id);

        const topRow = document.createElement("div");
        topRow.className = "flex items-center justify-between gap-2";

        const titleEl = document.createElement("h3");
        titleEl.className = "text-[11px] font-semibold text-slate-800";
        titleEl.textContent = task.title;

        const badge = document.createElement("span");
        badge.className =
          "rounded-full px-2 py-0.5 text-[10px] font-semibold " +
          lane.bg +
          " " +
          lane.text +
          " " +
          lane.border;
        badge.textContent = task.lane;

        topRow.appendChild(titleEl);
        topRow.appendChild(badge);

        const desc = document.createElement("p");
        desc.className = "text-[11px] text-slate-500";
        desc.textContent = task.description;

        const bottomRow = document.createElement("div");
        bottomRow.className =
          "mt-1 flex items-center justify-between gap-2 text-[10px] text-slate-400";

        const left = document.createElement("div");
        left.textContent = "Priority " + task.priority;

        const right = document.createElement("div");
        right.className = "flex items-center gap-1";
        const src = document.createElement("span");
        src.textContent = task.source;
        src.className =
          "rounded-full bg-slate-100 px-2 py-0.5 text-[10px] text-slate-500";
        right.appendChild(src);

        if (task.priority === 0) {
          const sky = document.createElement("span");
          sky.textContent = "SkyHawk boost";
          sky.className =
            "rounded-full bg-sky-100 px-2 py-0.5 text-[10px] text-sky-700";
          right.appendChild(sky);
        }

        bottomRow.appendChild(left);
        bottomRow.appendChild(right);

        const ctaRow = document.createElement("div");
        ctaRow.className = "mt-2 flex items-center justify-end";

        const focusBtn = document.createElement("button");
        focusBtn.textContent = "Focus this";
        focusBtn.className =
          "rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-[11px] text-blue-700 hover:bg-blue-100";
        focusBtn.addEventListener("click", (ev) => {
          ev.stopPropagation();
          focusTask(task.id);
        });

        ctaRow.appendChild(focusBtn);

        wrapper.appendChild(topRow);
        wrapper.appendChild(desc);
        wrapper.appendChild(bottomRow);
        wrapper.appendChild(ctaRow);

        wrapper.addEventListener("click", () => focusTask(task.id));

        taskStackEl.appendChild(wrapper);
      });

      taskCountEl.textContent = tasks.length;
    }

    // ---- PROJECT FIELD ----
    function renderProjectField() {
      projectGridEl.innerHTML = "";
      const sorted = tasks.slice().sort((a, b) => a.priority - b.priority);

      sorted.forEach((task) => {
        const lane = laneStyles(task.lane);
        const tile = document.createElement("article");
        tile.className =
          "glass-tile flex flex-col justify-between p-3 cursor-pointer select-none";

        tile.addEventListener("click", () => focusTask(task.id));

        const topRow = document.createElement("div");
        topRow.className = "flex items-start justify-between gap-2";

        const titleWrap = document.createElement("div");
        const title = document.createElement("h3");
        title.className = "text-[12px] font-semibold text-slate-900 leading-snug";
        title.textContent = task.title;
        const subtitle = document.createElement("p");
        subtitle.className = "mt-0.5 text-[11px] text-slate-500 line-clamp-2";
        subtitle.textContent = task.description;
        titleWrap.appendChild(title);
        titleWrap.appendChild(subtitle);

        const laneBadge = document.createElement("span");
        laneBadge.className =
          "rounded-full px-2 py-0.5 text-[10px] font-semibold " +
          lane.bg +
          " " +
          lane.text +
          " " +
          lane.border;
        laneBadge.textContent = task.lane;

        topRow.appendChild(titleWrap);
        topRow.appendChild(laneBadge);

        const middleRow = document.createElement("div");
        middleRow.className = "mt-2 flex items-center justify-between text-[10px]";

        const leftMiddle = document.createElement("div");
        leftMiddle.className = "flex items-center gap-1";
        const srcSpan = document.createElement("span");
        srcSpan.textContent = task.source;
        srcSpan.className =
          "rounded-full bg-slate-900 text-slate-100 px-2 py-0.5";
        leftMiddle.appendChild(srcSpan);

        const agents = document.createElement("div");
        agents.className = "flex items-center gap-1";
        agents.innerHTML = `
          <span class="rounded-full bg-slate-100 px-2 py-0.5">üß†</span>
          <span class="rounded-full bg-slate-100 px-2 py-0.5">‚ö°</span>
          <span class="rounded-full bg-slate-100 px-2 py-0.5">üõ∞Ô∏è</span>
        `;

        middleRow.appendChild(leftMiddle);
        middleRow.appendChild(agents);

        const bottomRow = document.createElement("div");
        bottomRow.className = "mt-2";

        const barBg = document.createElement("div");
        barBg.className = "h-1.5 w-full rounded-full bg-slate-200/80 overflow-hidden";

        const barFill = document.createElement("div");
        barFill.className = "h-full rounded-full bg-emerald-500 transition-all";
        barFill.style.width = Math.round((task.progress || 0) * 100) + "%";

        barBg.appendChild(barFill);

        const bottomMeta = document.createElement("div");
        bottomMeta.className =
          "mt-1 flex items-center justify-between text-[10px] text-slate-500";
        bottomMeta.innerHTML = `
          <span>Progress ${(task.progress * 100).toFixed(0)}%</span>
          <span>Priority ${task.priority}</span>
        `;

        bottomRow.appendChild(barBg);
        bottomRow.appendChild(bottomMeta);

        tile.appendChild(topRow);
        tile.appendChild(middleRow);
        tile.appendChild(bottomRow);

        projectGridEl.appendChild(tile);
      });
    }

    function focusTask(taskId) {
      const task = tasks.find((t) => t.id === taskId);
      if (!task) return;

      const minPriority = Math.min(...tasks.map((t) => t.priority));
      task.priority = minPriority - 1;

      focusTitleInput.value = task.title;
      focusDescriptionEl.textContent = task.description;
      focusBadgeEl.textContent = `${task.lane} ‚Ä¢ from ${task.source}`;
      focusBadgeEl.className =
        "text-[11px] " +
        (task.lane === "DO"
          ? "text-emerald-600"
          : task.lane === "SHOULD"
          ? "text-amber-600"
          : "text-slate-500");

      renderTaskStack(taskId);
      renderProjectField();
    }

    renderTaskStack();
    renderProjectField();

    // ===== SKYHAWK TOAST =====
    const toastEl = document.getElementById("toast");
    const toastTextEl = document.getElementById("toast-text");

    function showToast(msg) {
      toastTextEl.textContent = msg;
      toastEl.classList.remove("hidden");
      setTimeout(() => {
        toastEl.classList.add("hidden");
      }, 5000);
    }

    // Simulate SkyHawk finding key chairman details and boosting that task.
    setTimeout(() => {
      const t = tasks.find((x) => x.id === "chairman-outreach");
      if (!t) return;

      t.priority = 0; // Priority 0 = absolute top
      t.lane = "DO";
      t.source = "SkyHawk + OppGen";

      showToast(
        "SkyHawk: Found key charity chairman profile + contact ‚Äì boosted to Priority 0."
      );
      renderTaskStack("chairman-outreach");
      renderProjectField();
    }, 9000);
  </script>
</body>
</html>
